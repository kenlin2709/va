<section class="auth">
  <div class="container auth__wrap">
    <div class="authCard">
      <!-- Step Indicator -->
      <div class="authSteps">
        <div class="authStep" [class.authStep--active]="step() === 'email'" [class.authStep--done]="step() !== 'email'">
          <span class="authStep__num">1</span>
          <span class="authStep__label">Email</span>
        </div>
        <div class="authStep__line" [class.authStep__line--done]="step() !== 'email'"></div>
        <div class="authStep" [class.authStep--active]="step() === 'verify'" [class.authStep--done]="step() === 'details'">
          <span class="authStep__num">2</span>
          <span class="authStep__label">Verify</span>
        </div>
        <div class="authStep__line" [class.authStep__line--done]="step() === 'details'"></div>
        <div class="authStep" [class.authStep--active]="step() === 'details'">
          <span class="authStep__num">3</span>
          <span class="authStep__label">Details</span>
        </div>
      </div>

      <!-- Step 1: Email -->
      <ng-container *ngIf="step() === 'email'">
        <h1 class="authCard__title">Create account</h1>
        <p class="authCard__sub">Enter your email to get started.</p>

        <div class="authCard__referral" *ngIf="referralCode()">
          You've been referred! You'll both receive a <strong>$2 coupon</strong> after signing up.
        </div>

        <div class="authCard__error" *ngIf="error()">{{ error() }}</div>

        <form class="authForm" [formGroup]="emailForm" (ngSubmit)="submitEmail()">
          <label class="authField">
            <span class="authField__label">Email</span>
            <input class="authField__input" type="email" formControlName="email" autocomplete="email" />
          </label>

          <button class="authBtn" type="submit" [disabled]="loading()">
            {{ loading() ? 'Sending...' : 'Continue' }}
          </button>
        </form>
      </ng-container>

      <!-- Step 2: Verify Code -->
      <ng-container *ngIf="step() === 'verify'">
        <button class="authBack" type="button" (click)="goBack()">
          ← Back
        </button>
        <h1 class="authCard__title">Verify your email</h1>
        <p class="authCard__sub">We sent a 6-digit code to <strong>{{ emailForm.value.email }}</strong></p>

        <div class="authCard__error" *ngIf="error()">{{ error() }}</div>

        <form class="authForm" [formGroup]="codeForm" (ngSubmit)="submitCode()">
          <label class="authField">
            <span class="authField__label">Verification code</span>
            <input
              class="authField__input authField__input--code"
              type="text"
              formControlName="code"
              maxlength="6"
              inputmode="numeric"
              autocomplete="one-time-code"
            />
          </label>

          <button class="authBtn" type="submit" [disabled]="loading()">
            {{ loading() ? 'Verifying...' : 'Verify' }}
          </button>
        </form>

        <div class="authResend">
          <ng-container *ngIf="cooldown() > 0; else resendBtn">
            Resend code in {{ cooldown() }}s
          </ng-container>
          <ng-template #resendBtn>
            <button class="authResend__btn" type="button" (click)="resendCode()" [disabled]="loading()">
              Resend code
            </button>
          </ng-template>
        </div>
      </ng-container>

      <!-- Step 3: Details -->
      <ng-container *ngIf="step() === 'details'">
        <button class="authBack" type="button" (click)="goBack()">
          ← Back
        </button>
        <h1 class="authCard__title">Complete your account</h1>
        <p class="authCard__sub">Just a few more details.</p>

        <div class="authCard__error" *ngIf="error()">{{ error() }}</div>

        <form class="authForm" [formGroup]="detailsForm" (ngSubmit)="submitDetails()">
          <div class="authGrid2">
            <label class="authField">
              <span class="authField__label">First name</span>
              <input class="authField__input" type="text" formControlName="firstName" autocomplete="given-name" />
            </label>

            <label class="authField">
              <span class="authField__label">Last name</span>
              <input class="authField__input" type="text" formControlName="lastName" autocomplete="family-name" />
            </label>
          </div>

          <label class="authField">
            <span class="authField__label">Phone</span>
            <input class="authField__input" type="tel" formControlName="phone" autocomplete="tel" />
          </label>

          <label class="authField">
            <span class="authField__label">Password</span>
            <input class="authField__input" type="password" formControlName="password" autocomplete="new-password" />
            <span class="authHint">Minimum 8 characters.</span>
          </label>

          <button class="authBtn" type="submit" [disabled]="loading()">
            {{ loading() ? 'Creating...' : 'Create account' }}
          </button>
        </form>
      </ng-container>

      <div class="authCard__foot">
        <span>Already have an account?</span>
        <a [routerLink]="['/account/login']">Log in</a>
      </div>
    </div>
  </div>
</section>
